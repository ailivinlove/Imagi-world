<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸŒ€ Imagi-world: Neural Topology ðŸŒ€</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: #020208; color: #eee; min-height: 100vh; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        /* SHINY STAR GOLD TITLE */
        h1 { 
            margin: 20px 0; 
            font-size: 3rem; 
            text-align: center; 
            letter-spacing: 8px;
            font-weight: 900;
            background: linear-gradient(to right, #bf953f 0%, #fcf6ba 25%, #b38728 50%, #fbf5b7 75%, #aa771c 100%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.8));
            text-transform: uppercase;
            animation: shimmer 5s infinite linear;
            background-size: 200% auto;
        }

        @keyframes shimmer {
            to { background-position: 200% center; }
        }

        .container { max-width: 900px; width: 100%; }
        .controls { background: #0d1117; padding: 30px; border-radius: 20px; margin-bottom: 25px; border: 1px solid #bf953f; box-shadow: 0 0 30px rgba(191, 149, 63, 0.15); }
        .control-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 10px; font-weight: bold; color: #ffd700; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 1px; }
        
        input[type="range"] { width: 100%; height: 6px; background: #1a1a2e; border-radius: 3px; outline: none; -webkit-appearance: none; cursor: pointer; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; background: #ffd700; border-radius: 50%; border: 3px solid #aa771c; box-shadow: 0 0 10px #ffd700; }
        
        select { width: 100%; padding: 15px; background: #05050a; color: #fff; border: 1px solid #aa771c; border-radius: 10px; font-size: 1rem; cursor: pointer; outline: none; transition: 0.3s; }
        select:hover { border-color: #ffd700; box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }

        .button-group { display: flex; gap: 15px; margin-top: 10px; }
        button { flex: 1; padding: 20px; border-radius: 12px; border: none; font-weight: 900; cursor: pointer; transition: 0.3s; font-size: 1.1rem; text-transform: uppercase; letter-spacing: 1px; }
        #start-btn { background: linear-gradient(135deg, #ffd700, #b38728); color: #000; }
        #stop-btn { background: #1a1a2e; color: #e94560; border: 1px solid #e94560; }
        button:disabled { opacity: 0.2; cursor: not-allowed; }
        
        .game-area { background: #05050a; padding: 60px 40px; border-radius: 25px; text-align: center; border: 1px solid #1a1a40; position: relative; min-height: 450px; display: flex; flex-direction: column; justify-content: center; box-shadow: inset 0 0 50px rgba(0,0,0,0.8); }
        .status { font-size: 0.8rem; color: #444; margin-bottom: 20px; letter-spacing: 4px; font-weight: bold; }
        .premise-display { font-size: 2.2rem; color: #fff; margin: 40px 0; font-style: italic; min-height: 120px; display: flex; align-items: center; justify-content: center; line-height: 1.6; text-shadow: 0 0 15px rgba(255,255,255,0.1); }
        
        .response-buttons { display: flex; gap: 30px; width: 100%; }
        .response-buttons button { padding: 35px; font-size: 1.5rem; border: 2px solid transparent; }
        #match-btn { background: rgba(46, 204, 113, 0.1); color: #2ecc71; border-color: #2ecc71; }
        #no-match-btn { background: rgba(231, 76, 60, 0.1); color: #e74c3c; border-color: #e74c3c; }
        #match-btn:hover:not(:disabled) { background: #2ecc71; color: #000; }
        #no-match-btn:hover:not(:disabled) { background: #e74c3c; color: #fff; }

        #feedback { position: absolute; top: 20px; width: 100%; text-align: center; font-size: 1.8rem; font-weight: 900; letter-spacing: 2px; }
        .correct { color: #ffd700; text-shadow: 0 0 20px #ffd700; }
        .incorrect { color: #e94560; }

        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-top: 50px; width: 100%; }
        .stat-box { background: #0d1117; padding: 20px; border-radius: 15px; border: 1px solid #1a1a40; }
        .stat-label { font-size: 0.7rem; color: #555; margin-bottom: 8px; text-transform: uppercase; }
        .stat-value { font-size: 1.8rem; font-weight: bold; color: #ffd700; }
    </style>
</head>
<body>

<main class="container">
    <h1>IMAGI-WORLD</h1>
    
    <div class="controls">
        <div class="control-group">
            <label>Neural Lag (N-Back): <span id="n-val" style="color:#ffd700">1</span></label>
            <input type="range" id="n-slider" min="1" max="5" value="1">
        </div>

        <div class="control-group">
            <label>Topology Selection (Da Vinci Hierarchy):</label>
            <select id="logic-mode">
                <option value="0">Mode 0: Standard Linear (2 Nodes)</option>
                <option value="1">Mode 1: Dialectical Superposition (2 Nodes, Dual Constraint)</option>
                <option value="2">Mode 2: Semantic Tensor (3 Nodes, Intersection)</option>
                <option value="3">Mode 3: System Homology (4 Nodes, Meta-Isomorphism)</option>
                <option value="4">Mode 4: Complementary Interface (6 Nodes, Path-Linking)</option>
            </select>
        </div>

        <div class="control-group">
            <label>Neural Pulse Rate: <span id="spt-val" style="color:#ffd700">8.0</span>s</label>
            <input type="range" id="spt-slider" min="2" max="25" step="0.5" value="8.0">
        </div>

        <div class="button-group">
            <button id="start-btn">Initialize Link</button>
            <button id="stop-btn" disabled>Sever Link</button>
        </div>
    </div>

    <div class="game-area">
        <div id="feedback"></div>
        <div id="status" class="status">IDLE_SYSTEM</div>
        <div id="premise-display" class="premise-display">AWAITING_INPUT</div>
        
        <div class="response-buttons">
            <button id="match-btn" disabled>MATCH</button>
            <button id="no-match-btn" disabled>NO_MATCH</button>
        </div>

        <div class="stats">
            <div class="stat-box"><div class="stat-label">Cycle</div><div id="trial-count" class="stat-value">0</div></div>
            <div class="stat-box"><div class="stat-label">Sync</div><div id="score" class="stat-value">0</div></div>
            <div class="stat-box"><div class="stat-label">Precision</div><div id="accuracy" class="stat-value">0%</div></div>
        </div>
    </div>
</main>

<script type="module">
    /**
     * IMAGI-WORLD TOPOLOGY ENGINE
     * 1. Purged 'A' from all pools.
     * 2. Decoupled Logic (Key) from Semantics (Letters).
     * 3. Mode 3 (Homology) vs Mode 2 (Tensor) differentiation.
     */
    
    const SYMBOLS = "BCDEFGHJKLMNOPQRSTUVWXYZ".split(""); // ABSOLUTELY NO 'A'
    const REL = { N: 'north', S: 'south', E: 'east', W: 'west' };

    class Mulberry32 {
        constructor(seed) { this.state = seed >>> 0; }
        next() {
            let t = this.state += 0x6D2B79F5;
            t = Math.imul(t ^ t >>> 15, t | 1);
            t ^= t + Math.imul(t ^ t >>> 7, t | 61);
            return ((t ^ t >>> 14) >>> 0) / 4294967296;
        }
        choice(arr) { return arr[Math.floor(this.next() * arr.length)]; }
    }

    class DaVinciEngine {
        constructor() {
            this.history = [];
            this.score = 0;
            this.total = 0;
            this.running = false;
            this.rng = new Mulberry32(Date.now());
            this.synth = window.speechSynthesis;
        }

        init() {
            document.getElementById('start-btn').onclick = () => this.start();
            document.getElementById('stop-btn').onclick = () => this.stop();
            document.getElementById('n-slider').oninput = (e) => document.getElementById('n-val').textContent = e.target.value;
            document.getElementById('spt-slider').oninput = (e) => document.getElementById('spt-val').textContent = e.target.value;
            document.getElementById('match-btn').onclick = () => this.respond(true);
            document.getElementById('no-match-btn').onclick = () => this.respond(false);

            window.addEventListener('keydown', (e) => {
                if (!this.running) return;
                if (e.code === 'Space') { e.preventDefault(); this.respond(true); }
                if (e.code === 'Enter') { e.preventDefault(); this.respond(false); }
            });
        }

        speak(t) {
            this.synth.cancel();
            const u = new SpeechSynthesisUtterance(t);
            u.rate = 0.85; u.pitch = 1.0;
            this.synth.speak(u);
        }

        /**
         * MODE ARCHITECTURE
         * Mode 2: Intersection (3 Nodes)
         * Mode 3: Homology (4 Nodes, Symmetric Operators)
         */
        generate(mode, forceMatchKey = null) {
            const rS = () => this.rng.choice(SYMBOLS);
            const rD = () => this.rng.choice(['N', 'S', 'E', 'W']);
            const ortho = (d) => (d === 'N' || d === 'S') ? this.rng.choice(['E', 'W']) : this.rng.choice(['N', 'S']);

            let text, key;

            // 1. Resolve Geometric Key
            if (forceMatchKey) {
                key = forceMatchKey;
            } else {
                const d1 = rD(), d2 = ortho(d1), d3 = rD(), d4 = rD();
                switch(mode) {
                    case 1: key = `M1-${d1}-${d2}`; break;
                    case 2: key = `M2-${d1}-${d2}`; break;
                    case 3: key = `M3-${d1}-${d3}`; break; // d1 is the internal op, d3 is the bridge
                    case 4: key = `M4-${d1}${d2}-${d3}${d4}`; break;
                    default: key = `M0-${d1}`;
                }
            }

            // 2. Resolve Semantic Instance (Ensure Symbols are fresh and no 'A')
            const p = key.split('-');
            const m = p[0];
            let s1 = rS(), s2 = rS(), s3 = rS(), s4 = rS(), s5 = rS(), s6 = rS();
            // Symbol Uniqueness
            while(s2 === s1) s2 = rS();
            while(s3 === s1 || s3 === s2) s3 = rS();
            while(s4 === s1 || s4 === s2 || s4 === s3) s4 = rS();

            if (m === 'M1') {
                text = `${s1} is ${REL[p[1]]} and ${REL[p[2]]} of ${s2}`;
            } else if (m === 'M2') {
                // TENSOR: Shared head, perpendicular tails
                text = `${s1} is ${REL[p[1]]} of ${s2} and ${REL[p[2]]} of ${s3}`;
            } else if (m === 'M3') {
                // HOMOLOGY: Meta-comparison of two domain-shifts
                text = `(${REL[p[1]]} of ${s1}) is ${REL[p[2]]} of (${REL[p[1]]} of ${s2})`;
            } else if (m === 'M4') {
                // INTERFACE: Endpoint link of two divergent paths
                const dA1 = p[1][0], dA2 = p[1][1], dB1 = p[2][0], dB2 = p[2][1];
                text = `(${REL[dA1]}-${REL[dA2]} of ${s1}) is ${REL[rD()]} of (${REL[dB1]}-${REL[dB2]} of ${s2})`;
            } else {
                text = `${s1} is ${REL[p[1]]} of ${s2}`;
            }

            return { text, key };
        }

        start() {
            this.running = true; this.score = 0; this.total = 0; this.history = [];
            document.getElementById('start-btn').disabled = true;
            document.getElementById('stop-btn').disabled = false;
            document.getElementById('match-btn').disabled = false;
            document.getElementById('no-match-btn').disabled = false;
            this.run();
        }

        stop() {
            this.running = false;
            clearTimeout(this.timer);
            document.getElementById('start-btn').disabled = false;
            document.getElementById('stop-btn').disabled = true;
            document.getElementById('match-btn').disabled = true;
            document.getElementById('no-match-btn').disabled = true;
            document.getElementById('status').textContent = "LINK_TERMINATED";
        }

        run() {
            if (!this.running) return;
            const mode = parseInt(document.getElementById('logic-mode').value);
            const n = parseInt(document.getElementById('n-slider').value);
            
            // Logic: 35% chance of structural match requirement
            const isMatchTrial = this.history.length >= n && this.rng.next() < 0.35;
            const nBackMatch = isMatchTrial ? this.history[this.history.length - n] : null;
            
            let current;
            let safety = 0;
            // Generate unique semantic content while maintaining topological key for matches
            do {
                current = this.generate(mode, nBackMatch ? nBackMatch.key : null);
                safety++;
            } while (this.history.length > 0 && current.text === this.history[this.history.length-1].text && safety < 10);

            this.correctKey = nBackMatch ? nBackMatch.key : null;
            this.currentObj = current;

            const disp = document.getElementById('premise-display');
            disp.textContent = current.text;
            this.speak(current.text);

            this.total++;
            this.updateUI();

            this.answered = false;
            const ms = parseFloat(document.getElementById('spt-slider').value) * 1000;
            this.timer = setTimeout(() => { if (!this.answered) this.respond(null); }, ms);
        }

        respond(val) {
            if (this.answered || !this.running) return;
            this.answered = true;
            clearTimeout(this.timer);

            const fb = document.getElementById('feedback');
            const isMatch = (this.correctKey !== null && this.currentObj.key === this.correctKey);

            if (val === null) {
                fb.textContent = "TIMEOUT"; fb.className = "incorrect";
            } else if (val === isMatch) {
                this.score++; fb.textContent = "SYNC_SUCCESS"; fb.className = "correct";
            } else {
                fb.textContent = "ASYNC_ERROR"; fb.className = "incorrect";
            }

            this.history.push(this.currentObj);
            setTimeout(() => {
                fb.textContent = "";
                this.run();
            }, 1000);
        }

        updateUI() {
            document.getElementById('trial-count').textContent = this.total;
            document.getElementById('score').textContent = this.score;
            document.getElementById('accuracy').textContent = 
                this.total > 1 ? Math.round((this.score / (this.total - 1)) * 100) + "%" : "0%";
            document.getElementById('status').textContent = `CYCLE_${this.total}_ACTIVE`;
        }
    }

    const engine = new DaVinciEngine();
    engine.init();
</script>
</body>
</html>
